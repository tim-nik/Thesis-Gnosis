{% load static %}
<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="utf-8">
  <title>Το προφίλ μου</title>
  <link rel="stylesheet" href="{% static 'css/styles.css' %}?v={{ STATIC_VERSION }}">
  <style>
    /* Μόνο για το προφίλ */
    .profile-wrap{max-width:960px;margin:0 auto;padding:16px;}
    .profile-card{
      background:#fff;border:1px solid #eaeaea;border-radius:14px;
      padding:16px;box-shadow:0 1px 3px rgba(0,0,0,.04);margin-top:12px;
    }
    .profile-grid{display:flex;gap:18px;align-items:flex-start;flex-wrap:wrap;}
    .avatar{
      width:72px;height:72px;border-radius:50%;display:flex;align-items:center;justify-content:center;
      font-weight:800;background:#eef4ff;color:#3b57f5;font-size:26px;flex:0 0 72px;
    }
    .meta{flex:1;min-width:220px}
    .meta dl{margin:6px 0}
    .meta dt{font-weight:700;color:#333}
    .meta dd{margin:0 0 8px;color:#555}
    .actions{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}

    .badge-row{display:flex;gap:10px;flex-wrap:wrap}
    .badge{background:#f3f6ff;color:#203268;border:1px solid #e2e8ff;border-radius:999px;padding:6px 10px;font-weight:600}

    .course-list{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:10px}
    .course-item{border:1px solid #eee;border-radius:12px;padding:12px}
    .course-title{font-weight:800;margin-bottom:6px}
    .course-meta{color:#555;margin-bottom:8px}

    /* Progress bar (native <progress>) */
    progress{width:100%;height:12px;vertical-align:middle;appearance:none;-webkit-appearance:none}
    progress::-webkit-progress-bar{background:#f1f5f9;border-radius:8px}
    progress::-webkit-progress-value{background:#3b82f6;border-radius:8px}
    progress::-moz-progress-bar{background:#3b82f6;border-radius:8px}
    .progress-row{display:flex;align-items:center;gap:10px}
    .progress-pct{min-width:42px;text-align:right;font-weight:700;color:#1f2937}

    /* Badges */
    .badges-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px}
    .badge-card{border:1px solid #eee;border-radius:12px;padding:12px;text-align:center}
    .badge-card.badge--locked{opacity:.55;filter:grayscale(1)}
    .badge-icon{font-size:28px;line-height:1;margin-bottom:6px}
    .badge-title{font-weight:700}
    .badge-desc{font-size:14px;opacity:.8}
  </style>
</head>
<body>
  {% include "header.html" %}

  <main class="profile-wrap">
    <h1>Το προφίλ μου</h1>

    <!-- Κάρτα: στοιχεία χρήστη -->
    <section class="profile-card">
      <div class="profile-grid">
        <div class="avatar" aria-hidden="true">
          {{ user.username|first|upper }}
        </div>
        <div class="meta">
          <dl>
            <dt>Όνομα χρήστη</dt>
            <dd>{{ user.username }}</dd>
          </dl>
          <div class="actions">
            <a class="btn" href="/courses/">Τα μαθήματά μου</a>
          </div>
        </div>
      </div>
    </section>

    <!-- Κάρτα: σύνοψη προόδου & πόντων -->
    <section class="profile-card">
      <h2 style="margin:0 0 8px">Πρόοδος & Πόντοι</h2>
      <div class="badge-row">
        <span class="badge">Ολοκληρωμένα μαθήματα: {{ completed_count|default:0 }}</span>
        <span class="badge">Συμμετοχές σε κουίζ: {{ quiz_attempts_count|default:0 }}</span>
        <span class="badge">Σύνολο πόντων: {{ total_points|default:0 }}</span>
      </div>
    </section>

    <!-- Κάρτα: Εμβλήματα -->
    <section class="profile-card">
      <h2 style="margin:0 0 8px">Τα εμβλήματά μου</h2>
      <p class="muted">Κερδισμένα: {{ badges_earned|length|default:0 }} / {{ badges_all|length|default:0 }}</p>

      <div class="badges-grid">
  {% for b in badges_all %}
    {% if b.slug in badges_earned %}
      <div class="badge-card badge--owned">
        <div class="badge-icon" aria-hidden="true">
          {% if b.icon %}
            <img src="{% static b.icon %}?v={{ STATIC_VERSION }}" alt="" />
          {% else %}🏅{% endif %}
        </div>
        <div class="badge-title">{{ b.title }}</div>
        <div class="badge-desc">{{ b.description }}</div>
      </div>
    {% else %}
      <div class="badge-card badge--locked">
        <div class="badge-icon" aria-hidden="true">
          {% if b.icon %}
            <img src="{% static b.icon %}?v={{ STATIC_VERSION }}" alt="" />
          {% else %}🔒{% endif %}
        </div>
        <div class="badge-title">{{ b.title }}</div>
        <div class="badge-desc">{{ b.description }}</div>
      </div>
    {% endif %}
  {% empty %}
    <p class="muted">Δεν έχουν οριστεί ακόμη εμβλήματα.</p>
  {% endfor %}
</div>
    </section>

    <!-- Κάρτα: Πρόοδος ανά μάθημα -->
    <section class="profile-card">
      <h2 style="margin:0 0 8px">Πρόοδος ανά μάθημα</h2>

      {% if courses_data %}
        <ul class="course-list">
          {% for row in courses_data %}
            <li class="course-item">
              <div class="course-title">{{ row.course.title }}</div>

              <div class="course-meta">
                {{ row.completed_lessons }} / {{ row.total_lessons }} ολοκληρωμένα
                {% if row.next_lesson %}
                  • <a href="{% url 'courses:lesson_detail' row.next_lesson.id %}">Συνέχισε →</a>
                {% else %}
                  • Συγχαρητήρια! Ολοκλήρωσες όλα τα μαθήματα!!! 🏆🥇✨
                {% endif %}
              </div>

              <div class="progress-row">
                <progress value="{{ row.completed_lessons }}" max="{{ row.total_lessons|default:1 }}"></progress>
                <span class="progress-pct">
                  {% if row.total_lessons %}
                    {% widthratio row.completed_lessons row.total_lessons 100 %}%
                  {% else %}0%{% endif %}
                </span>
              </div>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="muted">Δεν υπάρχουν διαθέσιμα courses ακόμη.</p>
      {% endif %}
    </section>
  </main>
</body>
</html>
